<?xml version="1.0" encoding="UTF-8"?>
<project name="OpenCart" default="build" basedir=".">
    <property name="source" value="$WORKSPACE/upload"/>

    <target name="clean" description="Cleanup build artifacts">
        <delete dir="$WORKSPACE/tests/docs"/>
        <delete dir="$WORKSPACE/tests/logs"/>
        <delete dir="$WORKSPACE/tests/testresults"/>
    </target>

    <target name="prepare" depends="clean" description="Prepare for build">
        <mkdir dir="$WORKSPACE/tests/docs"/>
        <mkdir dir="$WORKSPACE/tests/logs"/>
        <mkdir dir="$WORKSPACE/tests/testresults"/>
    </target>

    <target name="lint" description="Perform syntax check of source code files">
        <apply executable="php" failonerror="true">
            <arg value="-l"/>
            <fileset dir="$WORKSPACE/upload">
                <include name="**/*.php"/>
                <modified/>
            </fileset>
        </apply>
    </target>

    <target name="phploc" description="Measure project size using PHPLOC">
        <exec executable="phploc">
            <arg value="--log-csv"/>
            <arg value="$WORKSPACE/tests/logs/phploc.csv"/>
            <arg path="$WORKSPACE/upload"/>
        </exec>
    </target>

    <target name="phpcs" description="Generate checkstyle.xml using PHP_CodeSniffer">
        <exec executable="phpcs">
            <arg line="--report=checkstyle --report-file=$WORKSPACE/tests/checkstyle.xml --standard=tests/phpcs/OpenCart/ruleset.xml --extensions=php ${source}/"/>
        </exec>
    </target>

    <target name="build" depends="prepare,phpcs,lint,phploc"/>
</project>